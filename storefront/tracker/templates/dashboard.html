{% extends 'base.html' %}

{% block content %}
        <!-- Dashboard Metrics -->
        <div class="dashboard-grid">
            <div class="card profit-card">
                <div class="metric-label">Today's Revenue</div>
                {% if today_metrics.total_revenue %}
                    <div class="metric-value">${{ today_metrics.total_revenue|floatformat:2 }}
                        {% if today_metrics.revenue_trend > 0 %}
                            <span class="trend-indicator trend-up">â†—</span>
                        {% elif today_metrics.revenue_trend < 0 %}
                            <span class="trend-indicator trend-down">â†˜</span>
                        {% endif %}
                    </div>
                    <div class="metric-trend">
                        {% if today_metrics.revenue_trend > 0 %}+{% endif %}
                        {{ today_metrics.revenue_trend|floatformat:0 }}% from yesterday
                    </div>
                {% else %}
                    <div class="metric-value">$0.00</div>
                    <div class="metric-trend">No revenue data yet</div>
                {% endif %}
            </div>

            <div class="card loss-card">
                <div class="metric-label">Today's Expenses</div>
                {% if today_metrics.total_expenses %}
                    <div class="metric-value">${{ today_metrics.total_expenses|floatformat:2 }}
                        {% if today_metrics.expense_trend > 0 %}
                            <span class="trend-indicator trend-up">â†—</span>
                        {% elif today_metrics.expense_trend < 0 %}
                            <span class="trend-indicator trend-down">â†˜</span>
                        {% endif %}
                    </div>
                    <div class="metric-trend">
                        {% if today_metrics.expense_trend > 0 %}+{% endif %}
                        {{ today_metrics.expense_trend|floatformat:0 }}% from yesterday
                    </div>
                {% else %}
                    <div class="metric-value">$0.00</div>
                    <div class="metric-trend">No expense data yet</div>
                {% endif %}
            </div>

            <div class="card">
                <div class="metric-label">Net Profit</div>
                {% if today_metrics.total_profit %}
                    <div class="metric-value {% if today_metrics.total_profit >= 0 %}profit-positive{% else %}profit-negative{% endif %}">
                        ${{ today_metrics.total_profit|floatformat:2 }}
                    </div>
                    <div class="metric-subtitle">
                        Profit Margin: {{ today_metrics.profit_margin|floatformat:1 }}%
                    </div>
                {% else %}
                    <div class="metric-value">$0.00</div>
                    <div class="metric-subtitle">No profit data yet</div>
                {% endif %}
            </div>

            <div class="card">
                <div class="metric-label">AI Risk Score</div>
                {% if today_metrics.risk_score %}
                    <div class="metric-value risk-score-{% if today_metrics.risk_score < 4 %}low{% elif today_metrics.risk_score < 7 %}medium{% else %}high{% endif %}">
                        {{ today_metrics.risk_score|floatformat:1 }}/10
                    </div>
                    <div class="metric-subtitle">
                        {% if today_metrics.risk_score < 4 %}Low Risk Level
                        {% elif today_metrics.risk_score < 7 %}Medium Risk Level
                        {% else %}High Risk Level{% endif %}
                    </div>
                {% else %}
                    <div class="metric-value risk-score-none">-/10</div>
                    <div class="metric-subtitle">Insufficient data</div>
                {% endif %}
            </div>
        </div>

        <!-- AI Insights Section -->
        <div class="ai-insights">
            <h3>ðŸ¤– AI Loss Prevention Insights</h3>
            
            {% if ai_insights %}
                {% for insight in ai_insights %}
                    <div class="insight-item">
                        <div class="insight-severity severity-{{ insight.severity|lower }}">
                            {{ insight.severity|upper }} PRIORITY
                        </div>
                        <h4>{{ insight.title }}</h4>
                        <p>{{ insight.description }}</p>
                    </div>
                {% endfor %}
            {% else %}
                <div class="insight-item">
                    <div class="insight-severity severity-low">NO INSIGHTS YET</div>
                    <h4>Start Adding Transactions</h4>
                    <p>Add your business transactions to receive AI-powered insights and recommendations.</p>
                </div>
            {% endif %}
        </div>

        <!-- Prediction Box -->
        <div class="prediction-box">
            <h3>ðŸ“Š AI Profit Prediction - Next 7 Days</h3>
            {% if predictions %}
                <div class="prediction-range">
                    Expected Profit Range: <strong>${{ predictions.0.revenue_low|floatformat:0 }} - ${{ predictions.0.revenue_high|floatformat:0 }}</strong>
                </div>
                <div class="prediction-accuracy">
                    <strong>Model Accuracy:</strong> {{ predictions.0.model_accuracy|floatformat:0 }}%
                </div>
            {% else %}
                <div class="prediction-range">
                    <strong>Insufficient data for predictions</strong>
                </div>
                <div class="prediction-accuracy">
                    Add more transactions to receive AI-powered predictions
                </div>
            {% endif %}
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h3>Quick Actions</h3>
            <div class="quick-actions">
                <button class="action-btn" onclick="addTransaction('sale')">
                    ðŸ’° Add Sale
                </button>
                <button class="action-btn" onclick="addTransaction('expense')">
                    ðŸ’¸ Add Expense
                </button>
                <button class="action-btn" onclick="addTransaction('loss')">
                    ðŸ“‰ Record Loss
                </button>
                <button class="action-btn photo-btn" onclick="startPhotoInput()">
                    ðŸ“¸ Photo Receipt
                </button>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="card">
            <h3>Recent Transactions</h3>
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Description</th>
                        <th>Category</th>
                        <th>Amount</th>
                        <th>AI Insight</th>
                    </tr>
                </thead>
                <tbody>
                    {% if recent_transactions %}
                        {% for transaction in recent_transactions %}
                            <tr>
                                <td>{{ transaction.timestamp|date:"g:i A" }}</td>
                                <td>{{ transaction.description }}</td>
                                <td>{{ transaction.transaction_type|title }}</td>
                                <td class="amount-{% if transaction.transaction_type == 'sale' %}positive{% else %}negative{% endif %}">
                                    {% if transaction.transaction_type == 'sale' %}+{% endif %}
                                    ${{ transaction.amount|floatformat:2 }}
                                </td>
                                <td>{{ transaction.ai_insight }}</td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="5" class="no-data-message">
                                No transactions recorded yet. Use the Quick Actions above to add your first transaction.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
{% endblock %}